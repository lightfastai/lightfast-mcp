---
title: Blender Integration
description: How to use Lightfast MCP with Blender
---

# Blender Integration

Lightfast MCP provides a powerful bridge between AI models and Blender, allowing you to automate tasks, generate content, and control Blender via AI.

## Architecture Overview

The Blender integration follows this architecture:

```
Claude/LLM → Lightfast MCP Server → Socket Connection → Lightfast Addon → Blender
```

- **Claude/LLM**: The AI model that provides intelligence and understanding
- **Lightfast MCP Server**: A Python server (`blender_mcp_server.py`) that implements the Model Context Protocol
- **Socket Connection**: A TCP connection between the server and addon on port 9876 (default)
- **Lightfast Addon**: A Blender addon (`lightfast_blender_addon.py`) that runs inside Blender 
- **Blender**: The 3D application where commands are executed

## Setting Up Blender

After following the [installation instructions](../installation), you need to:

1. Start Blender
2. Enable the Lightfast MCP addon in Preferences > Add-ons
3. Open the Lightfast MCP panel in the sidebar (View > Sidebar or press N)
4. Click "Start MCP Server" to start the Blender socket server
5. The server should show "Server active on port 9876"

## Starting the MCP Server

Start the MCP Python server:

```bash
# Direct command
python -m lightfast_mcp.servers.blender_mcp_server

# Or from Python code
from lightfast_mcp.servers.blender_mcp_server import mcp
mcp.run()
```

## Available Commands

The Blender MCP integration provides two main commands:

### 1. Get State

Retrieve information about the current Blender scene:

```python
import asyncio
from lightfast_mcp.servers.blender_mcp_server import get_state

async def get_blender_info():
    scene_info = await get_state()
    print(scene_info)

asyncio.run(get_blender_info())
```

This returns a JSON string with details about:
- Current scene name
- Number of objects
- Selected objects
- Active object
- Render engine
- Current file path
- List of objects in the scene

### 2. Execute Command

Run Python code directly in Blender:

```python
import asyncio
from lightfast_mcp.servers.blender_mcp_server import execute_command

async def run_blender_code():
    code = """
    import bpy
    
    # Create a simple cube
    bpy.ops.mesh.primitive_cube_add(size=2, location=(0, 0, 0))
    cube = bpy.context.active_object
    cube.name = 'AI_Cube'
    
    # Return some information
    return f"Created cube named {cube.name}"
    """
    
    result = await execute_command(code_to_execute=code)
    print(result)

asyncio.run(run_blender_code())
```

## Connection Management

The Blender MCP server automatically manages the connection:

- It automatically attempts to connect to Blender on port 9876 (default)
- If the connection fails, it scans nearby ports (9876-9886)
- It handles reconnection if the connection is lost
- It verifies the connection with a ping before operations

## Error Handling

The server provides specific error types for different issues:

- `BlenderConnectionError`: When it can't connect to Blender
- `BlenderCommandError`: When a command fails in Blender
- `BlenderTimeoutError`: When a command takes too long
- `BlenderResponseError`: When the response from Blender is invalid
- `BlenderMCPError`: General error type for other issues

Example of proper error handling:

```python
import asyncio
from lightfast_mcp.servers.blender_mcp_server import execute_command
from lightfast_mcp.exceptions import BlenderConnectionError, BlenderCommandError

async def safe_run_command():
    try:
        result = await execute_command(code_to_execute="import bpy; return len(bpy.data.objects)")
        print(f"Number of objects: {result}")
    except BlenderConnectionError:
        print("Could not connect to Blender. Make sure it's running with the addon enabled.")
    except BlenderCommandError as e:
        print(f"Command failed: {e}")
    except Exception as e:
        print(f"Unexpected error: {e}")

asyncio.run(safe_run_command())
```

## MCP Client Integration

For AI applications that support the Model Context Protocol, connect directly:

```python
from mcp.client import Client

async def connect_to_blender():
    client = Client()
    await client.connect("localhost:9877")  # MCP server port (not Blender's port)
    
    # Get state
    state = await client.get_state()
    
    # Execute Blender code
    result = await client.execute_command(
        code_to_execute="import bpy; return 'Blender version: ' + bpy.app.version_string"
    )
    
    return result
```

## Best Practices

1. **Check connection before operations**:
   ```python
   from lightfast_mcp.servers.blender_mcp_server import check_blender_running
   
   if check_blender_running():
       # Proceed with operations
   else:
       print("Blender is not running or the addon is not active")
   ```

2. **Use async/await properly**:
   All server operations are asynchronous and should be used with `await`.

3. **Handle resources properly**:
   The server uses a connection pool that's automatically managed, but for long-running applications, explicitly close connections when done.

4. **Break complex operations into smaller steps**:
   For complex Blender operations, break them into smaller steps to avoid timeouts.

5. **Send small amounts of data**:
   Avoid sending very large meshes or textures through the socket connection.

## Troubleshooting

If you encounter issues:

1. **Blender addon not connecting**:
   - Check the Blender console for error messages
   - Verify the addon is enabled in Preferences > Add-ons
   - Make sure no other application is using port 9876

2. **MCP server can't find Blender**:
   - Make sure Blender is running
   - Check that the Lightfast MCP panel shows "Server active"
   - Try restarting both Blender and the MCP server

3. **Slow performance**:
   - Break complex operations into smaller commands
   - Avoid sending large amounts of data
   - Use asynchronous operations effectively

4. **Security warnings**:
   - The connection is local only by default
   - For remote connections, add firewall rules
   - Be careful what code you allow to execute in Blender 